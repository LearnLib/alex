<div class="view">
    <view-header title="{{vm.symbol.name}}" ng-if="vm.symbol">
        <a ui-sref="symbols({projectId: vm.project.id})" class="btn btn-sm btn-default btn-icon"
           uib-tooltip="Back to symbols" tooltip-placement="right">
            <i class="fa fa-reply"></i>
        </a>
    </view-header>

    <action-bar>
        <button class="btn btn-success btn-sm pull-right" ng-click="vm.saveChanges()">
            Save
        </button>
    </action-bar>

    <div class="view-body has-sub-nav">
        <div class="alx-container-fluid">

            <div class="panel panel-default" ng-if="vm.symbol.description != null && vm.symbol.description !== ''">
                <div class="panel-heading">
                    <strong>Description</strong>
                </div>
                <div class="panel-body">
                    <strong>Description</strong>
                    <p class="text-muted" style="white-space:pre-wrap;">{{vm.symbol.description}}</p>
                    <strong>Expected result</strong>
                    <p class="text-muted mb-0 pb-0" style="white-space:pre-wrap;">{{vm.symbol.expectedResult}}</p>
                </div>
            </div>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <strong>Actions</strong>
                </div>
                <div class="p-1 border-bottom d-flex flex-row">
                    <div>
                        <selectable-checkbox-multiple
                            selectable="vm.selectedSteps"
                            class="pull-left"
                            style="margin-top: 7px"
                            ng-if="vm.selectedSteps != null"
                        >
                        </selectable-checkbox-multiple>
                    </div>
                    <div class="w-100 ml-1">

                        <div class="btn-group btn-group-sm" uib-dropdown>
                            <button class="btn btn-primary btn-dropdown" uib-dropdown-toggle>
                                Add <i class="fa fa-fw fa-caret-down"></i>
                            </button>
                            <ul uib-dropdown-menu class="dropdown-menu" role="menu">
                                <li>
                                    <a
                                      href=""
                                      action-create-modal-handle
                                      on-created="vm.addAction(action)"
                                    >
                                        Action
                                    </a>
                                </li>
                                <li>
                                  <a href="" ng-click="vm.addSymbolStep()">
                                    Symbol
                                  </a>
                                </li>
                            </ul>
                        </div>

                        <div class="btn-group btn-group-sm">
                            <button
                                class="btn btn-default"
                                ng-class="{'disabled': vm.selectedSteps.getSelected().length !== 1}"
                                on-updated="vm.updateAction(action)"
                                ng-click="vm.editSelectedAction()"
                            >
                                Edit
                            </button>
                            <button
                                class="btn btn-default"
                                ng-click="vm.deleteSelectedSteps()"
                                ng-class="{'disabled': vm.selectedSteps.getSelected().length === 0}"
                            >
                                Delete
                            </button>
                        </div>

                        <div class="btn-group btn-group-sm" uib-dropdown>
                            <button class="btn btn-default" uib-tooltip="Copy" tooltip-placement="bottom"
                                    ng-click="vm.copySelectedSteps()">
                                <i class="fa fa-copy fa-fw"></i>
                            </button>
                            <button class="btn btn-default" uib-tooltip="Cut" tooltip-placement="bottom" ng-click="vm.cutSelectedSteps()">
                                <i class="fa fa-cut fa-fw"></i>
                            </button>
                            <button class="btn btn-default" uib-tooltip="Paste" tooltip-placement="bottom" ng-click="vm.pasteSteps()">
                                <i class="fa fa-paste fa-fw"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="panel-body" style="padding: 0">
                    <div class="action-list" dragula='"actionList"' dragula-model="vm.symbol.steps" ng-if="vm.symbol.steps.length > 0">
                        <div class="action-list-item" ng-repeat="step in vm.symbol.steps track by $index"
                             ng-class="{'disabled': step.disabled}">

                            <div class="d-flex flex-row align-items-center">
                                <div>
                                    <selectable-checkbox
                                      item="step"
                                      selectable="vm.selectedSteps"
                                    >
                                    </selectable-checkbox>
                                </div>

                                <div style="padding: 0 10px" class="text-muted">
                                    <span>{{$index + 1}})</span>
                                </div>

                                <div class="w-100 action-step">
                                    <div class="action-description" ng-if="step.type === 'action'" ng-bind="step.action.toString()"></div>
                                    <div class="symbol-description" ng-if="step.type === 'symbol'">
                                        <span class="symbol-description">
                                            Execute symbol
                                            <a ui-sref="symbol({projectId: vm.project.id, symbolId: step.pSymbol.symbol.id})">
                                                <strong>{{step.pSymbol.symbol.name}}</strong>
                                            </a>
                                        </span>
                                        <br>
                                        <symbol-parameters parameter-values="step.pSymbol.parameterValues"></symbol-parameters>
                                    </div>

                                    <div class="step-labels">
                                        <span class="label label-info" ng-show="step.negated">Negate</span>
                                        <span class="label label-danger" ng-show="step.ignoreFailure">Ignore Failure</span>
                                    </div>
                                    <div class="step-output text-muted d-flex">
                                        <div style="flex-shrink: 0">
                                            <em>Output on error:&nbsp;</em>
                                        </div>
                                        <div class="w-100 input-parameter-value" style="position: relative">
                                            <i class="fa fa-fw fa-close cursor-pointer"
                                               ng-click="step.errorOutput = null"></i>
                                            <em>
                                                <input
                                                  class="w-100 d-block"
                                                  type="text"
                                                  ng-model="step.errorOutput"
                                                  placeholder="Failed ({{$index + 1}})"
                                                >
                                            </em>
                                        </div>
                                    </div>
                                </div>

                                <div>
                                    <span class="btn btn-sm" ng-click="vm.toggleDisableAction(step)">
                                        <span ng-show="!step.disabled" tooltip-placement="left" uib-tooltip="Disable">
                                            <i class="fa fa-toggle-on fa-fw text-success"></i>
                                        </span>
                                        <span ng-show="step.disabled" tooltip-placement="left" uib-tooltip="Enable">
                                            <i class="fa fa-toggle-off fa-fw text-danger"></i>
                                        </span>
                                    </span>
                                </div>

                                <div>
                                    <div class="btn-group btn-group-sm" uib-dropdown>
                                        <button type="button" class="btn btn-default btn-icon dropdown-toggle" uib-dropdown-toggle>
                                            <i class="fa fa-bars"></i>
                                        </button>
                                        <ul uib-dropdown-menu class="dropdown-menu pull-right" role="menu">
                                            <li>
                                                <a href="" ng-click="vm.editActionStep(step)" ng-if="step.type === 'action'">
                                                    <i class="fa fa-edit fa-fw"></i> Edit
                                                </a>
                                                <a href="" ng-click="vm.editSymbolStep(step)" ng-if="step.type === 'symbol'">
                                                    <i class="fa fa-edit fa-fw"></i> Edit
                                                </a>
                                            </li>
                                            <li>
                                                <a href="" ng-click="vm.deleteStep($index)">
                                                    <i class="fa fa-trash fa-fw"></i> Delete
                                                </a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="" ng-click="vm.cutStep($index)">
                                                    <i class="fa fa-cut fa-fw"></i> Cut
                                                </a>
                                            </li>
                                            <li>
                                                <a href="" ng-click="vm.copyStep($index)">
                                                    <i class="fa fa-copy fa-fw"></i> Copy
                                                </a>
                                            </li>
                                            <li class="divider"></li>
                                            <li>
                                                <a href="" ng-click="step.negated = !step.negated">
                                                    <i class="fa fa-fw" ng-class="{'fa-check': step.negated}"></i>
                                                    Negate result
                                                </a>
                                            </li>
                                            <li>
                                                <a href="" ng-click="step.ignoreFailure = !step.ignoreFailure">
                                                    <i class="fa fa-fw" ng-class="{'fa-check': step.ignoreFailure}"></i>
                                                    Ignore failure
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>

                    <div class="alert alert-info" ng-if="vm.symbol.steps.length === 0" style="margin: 15px">
                        You haven't created any steps for this symbol.
                    </div>
                </div>
            </div>

            <symbol-parameters-panel symbol="vm.symbol" on-change="vm.setChanged(true)"></symbol-parameters-panel>

            <div class="panel panel-default">
                <div class="panel-heading">
                    <strong>Output on success</strong>
                </div>
                <div class="panel-body" style="padding-bottom: 0">
                    <div class="form-group">
                        <input class="form-control" type="text" ng-model="vm.symbol.successOutput" placeholder="Ok"
                               ng-change="vm.hasChanged = true">
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
